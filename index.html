<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>리로스쿨</title>
    <link href="./src/style.css" rel="stylesheet">
</head>
<body>
    <div class="header" id="header">
        <!-- <img src="./src/menubtn.svg" height="30px" class="menubtn" onclick="menutoggle()"> -->
    </div>
    <!-- <a href="about:blank" target="_blank"><button style="height: 100px;">asdf</button></a> -->
    <webview src="https://dankook.riroschool.kr/user.php?action=signin" id="riro" style="display:none !important;" webpreferences="nativeWindowOpen=true" allowpopups>
    </webview>

    <div class="loginpage">
        <div class="loginform">
                <img src="./src/logo.png" height="60px">
                <div class="loginerror" style="display:none;">다시 로그인해주세요</div>
                <div class="loader"></div>
                <div id="logininputs" style="display:none;">
                    <div class="form"><input placeholder="학교 아이디 또는 이메일" id="idinput"></div>
                    <div class="form"><input placeholder="비밀번호" type="password" id="pwinput" ></div>
                    <div class="form2"><input type='checkbox' id="autologin"  title="아이디와 비밀번호는 기기 내에만 저장됩니다"/><label for="autologin" title="아이디와 비밀번호는 기기 내에만 저장됩니다">자동로그인</label></div>
                    <button type="submit" value="로그인" class="loginbtn" id="loginbtn" onclick="login(idinput.value, pwinput.value);">로그인</button>
                </div>
        </div>
    </div>
    <script src="./src/renderer.js"></script>
    <script>
        webview = document.querySelector('#riro');
        header = document.querySelector('#header');
        pgbar = document.querySelector('.loader');
        css = `
        .treeWrap {padding-top: 30px !important;box-shadow: none !important;border-right: 1px solid #d6d6d6 !important;}
.btn_side_menu_control {margin-top: 30px !important;}
.treeWrap .user .user_inner {border-radius: 10px !important;margin-bottom:0 !important;}
.user_btn {margin-top: 20px !important;}
.main-btn.txt-icon {display: none !important;}
.gnb_list {height: calc(100% - 220px) !important;}

.magnify-header {
    margin-top: 30px !important;
}

.magnify-stage {
    margin-top: 30px !important;
}

::-webkit-scrollbar-thumb {
    border: 1.5px solid white !important;
    border-radius: 100px !important;
    background: #777777 !important;
}

.treeWrap .user .user_inner .inner_top .left .name_type_wrap .name_type .type {
    color: #00499d !important;
}

.gnb_list > .li.checked > span {color: #00499d !important;}

span.riro-label {
    background: #00499d;
    border: 1px solid #00499d;
}

.portfolio_wrap .btm_wrap a.btn_save {
    background: #00499d !important;
}

.re_menucon_li_rinktitle_b {
    color: #00499d !important;
}

.re_menucon_li_rink {
    color: #00499d !important;
}

.wh_search_box .btn_sch_pc span {
    color: #00499d !important;
}

.wh_search_box .link_wrap {
    border: 1px solid #00499d !important;
}

.re_search_btn {
    background: #00499d !important;
}

.pagei {
    background: #00499d !important;
}

::-webkit-scrollbar {
    width: 6px !important;
    height: 6px !important;
    background: none !important;
}

.gnb_list::-webkit-scrollbar-track {
    background: none !important;
}

p.last.riro_menu {
    border-radius: 30px !important;
    margin-top: 10px !important;
}

.only_pc.user_inner.clearfix {
    border-radius: 30px !important;
}

img.re_main_img {
    border-radius: 30px !important;
}

.search_zone {
    border-radius: 30px !important;
}

.link_wrap {
    border-radius: 30px !important;
}

ul.home-box.home_list.re_menucon_wrap {
    border-radius: 30px !important;
}

ul.home-box.re_menucon_wrap {
    border-radius: 30px !important;
}

.treeWrap {
    border-bottom-right-radius: 30px !important;
}

a#portfolio_search_btn {
    border-radius: 16px !important;
}

.riro-label {
    border-radius: 10px !important;
}

table {
}

img.icon_label.icon_label_students {
    border-radius: 30px !important;
}

select {
    border-radius: 30px !important;
}

input.re_search_input {
}

p.search_input {
}

.renewal_wrap .search_input .re_search_input {
    border-radius: 30px !important;
}

a.re_search_btn {
    border-radius: 30px !important;
}

.search_part,fix.clearfix {
    border-radius: 30px !important;
}

button {
    border-radius: 30px !important;
}

input {
    border-radius: 30px !important;
}

.pagei {
    border-radius: 30px !important;
}

.reserve_year_month_box {
    border-radius: 30px !important;
}

ul.type_tab_list {
    border-radius: 30px !important;
}

.q_box {
    border-radius: 30px !important;
}

p.q_tit {border-top-left-radius: 30px !important;border-top-right-radius: 30px !important;}

a.btn_file.btn_file_non_after {
    border-radius: 30px !important;
}

a.rd_btn {
    border-radius: 30px !important;
}

a.btn_portfolio_my {
    border-radius: 30px !important;
}

a.pagei {
    border-radius: 30px !important;
}

a.btn_file {
    border-radius: 30px !important;
}

.btn {
    border-radius: 30px !important;
}

.btn_save {
    border-radius: 30px !important;
}

.btn_cancel {
    border-radius: 30px !important;
}

.riro-calendar {
    background: transparent !important;
    backdrop-filter: blur(10px) !important;
    border-radius: 30px !important;
}

table.table_trans {
    background: none !important;
}

table[bgcolor="white"] {
    background: none !important;
    backdrop-filter: blur(10px) !important;
}

.meal_schedule_popup {
    background: transparent !important;
    backdrop-filter: blur(20px) !important;
}

.back {
    background: none !important;
}

.title {
    background: transparent !important;
    backdrop-filter: blur(20px) !important;
}

.type.tab {
    background: transparent !important;
    backdrop-filter: blur(20px) !important;
    z-index: 9999 !important;
}

.sel_box_inner {
    border-radius: 30px !important;
}

.sel_box_popup {
    border-radius: 30px !important;
}

.sel_box_inner {
    background: transparent !important;
    backdrop-filter: blur(20px) !important;
}

.date_title {
}

ul.msg_content_container_left {
    border-radius: 30px !important;
}

section#msg_item_detail_tab {
    border-radius: 30px !important;
}

button.tab_btn.notice_btn.\\30 {
    border-top-right-radius: 0px !important;
    border-bottom-right-radius: 0px !important;
}

button.tab_btn.question_btn {
    border-top-left-radius: 0px !important;
    border-bottom-left-radius: 0px !important;
}

.search_key_wrap {
    border-radius: 30px !important;
}

.btm_gray_box {
    border-radius: 30px !important;
    margin-bottom: 20px !important;
}

.btn_fixed {
    border-radius: 30px !important;
}

.wh_body .page_wrap .page_list li {
    border-radius: 30px !important;
}

.elem_fix {
    border-radius: 30px !important;
}
        `

        webview.addEventListener("load-commit", (e) => {
            try {
                webview.insertCSS(css);
            } catch (error) {
                webview.reload();
            }
            if (e.url.startsWith('https://dankook.riroschool.kr/') == false && e.url != 'about:blank') {
                webview.goBack()
                openExternal(e.url);
                console.log(e.url);
            }
            if (webview.isDevToolsOpened() == false) {
                // webview.openDevTools();
            }
            if (e.url == "https://dankook.riroschool.kr/") {       
                loginpage.style.display = 'none';
                webview.style.display = '';
                if (autologin.checked) {
                    save('id', idinput.value);
                    save('pw', pwinput.value);
                }
                webview.setAttribute('src', 'https://dankook.riroschool.kr/home.php')
            }
            else if (e.url == "https://dankook.riroschool.kr/user.php?action=signin") {
                loginpage.style.display = 'block';
                webview.style.display = 'none';
                loadidpw();
            }
        })

        webview.addEventListener("dom-ready", (e) => {
            header.style.display = 'block';
            webview.executeJavaScript(`document.querySelectorAll("a[target='_blank']").forEach((e) => {
                e.setAttribute("target", "")
            })
            document.onkeydown = (e) => {
    if (e.key == "r" && e.ctrlKey) {
        e.preventDefault();
        location.reload();
    }
}    
            `)
        });

        webview.addEventListener("will-navigate", (e) => {
            if (e.url == "https://dankook.riroschool.kr/user.php?action=user_logout") {
                idinput.value = '';
                pwinput.value = '';
                autologin.checked = false;
                resetidpw();
            }
        });

        idinput = document.querySelector('#idinput');
        pwinput = document.querySelector('#pwinput');
        loginbtn = document.querySelector('#loginbtn');
        autologin = document.querySelector('#autologin');
        loginpage = document.querySelector('.loginpage');

        idinput.addEventListener("keydown", (e) => {
            if (e.keyCode == 13) {
                pwinput.focus();
            }
        })
        
        pwinput.addEventListener("keydown", (e) => {
            if (e.keyCode == 13) {
                login(idinput.value, pwinput.value);
            }
        })

        function login(id, pw) {
            webview.executeJavaScript(`document.querySelector(".input_normal[type='text']").value = "${id}";
            document.querySelector(".input_normal[type='password']").value = "${pw}";
            document.querySelector(".renewal_signin_container .button_normal").click();
            `)
        }
</script>
</body>
</html>